<!DOCTYPE html>

<html>
    <head>
        <meta charset="UTF-8" >
        <title>Echo</title>
        <script src="chat.js"></script>
    </head>
    <body>
        <div id="elm-node"></div>
        <script>
         const app = Elm.Main.init({node: document.getElementById("elm-node")});
         const wsUri = (window.location.protocol=='https:'&&'wss://'||'ws://')+window.location.host + '/ws/';
         const socket = new WebSocket(wsUri);
         /* const socket = new WebSocket("ws://echo.websocket.org"); */

         // Listen for messages
         socket.addEventListener('message', function (event) {
             app.ports.websocketIn.send(JSON.stringify({data:message.data,timeStamp:message.timeStamp}));
         });

         // Listen for server responses
         socket.onmessage = function(message) {
             console.log(message);
             app.ports.websocketIn.send(JSON.stringify({data:message.data,timeStamp:message.timeStamp}));
         };

         app.ports.websocketOut.subscribe(function(msg) { socket.send(msg); });
        </script>
    </body>
</html>
